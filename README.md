# üê± –£—á–µ–±–Ω—ã–π –±—ç–∫–µ–Ω–¥ –Ω–∞ Go

API –¥–ª—è –∫–æ—Ç–∏–∫–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, —Å–µ—Å—Å–∏—è–º–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π ¬´–∫–∞–∫ —É –≤–∑—Ä–æ—Å–ª—ã—Ö¬ª.

> –°–µ–π—á–∞—Å –ø—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –ø–∞–º—è—Ç–∏** (in‚Äëmemory), –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.  
> –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –ø–µ—Ä–µ–µ–∑–¥ –Ω–∞ PostgreSQL –∏–ª–∏ SQLite.

---

## üöÄ –ß—Ç–æ —É–º–µ–µ—Ç –ø—Ä–æ–µ–∫—Ç

### üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (`POST /register`)
- –õ–æ–≥–∏–Ω (`POST /login`)
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è **—Ç–æ–ª—å–∫–æ –≤ –≤–∏–¥–µ —Ö—ç—à–∞** (bcrypt)
- In‚Äëmemory —Å–µ—Å—Å–∏–∏: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `session_id` + cookie
- Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ `AuthRequired` (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—É–∫—É –∏ —Å–µ—Å—Å–∏—é)
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET /me` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Å–µ—Å—Å–∏–∏

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è DTO:

- `UserCreateRequest` ‚Äî –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `UserLoginRequest` ‚Äî –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ª–æ–≥–∏–Ω–∞
- `UserResponse` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ `PasswordHash`

### üßç –í–ª–∞–¥–µ–ª—å—Ü—ã (owners)

- –ú–æ–¥–µ–ª—å `Owner` + –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `OwnerRepo` + `InMemoryOwnerRepo`
- –ü–æ–ª–Ω—ã–π CRUD:
  - `GET /owners`
  - `GET /owners/:id`
  - `POST /owners`
  - `DELETE /owners/:id`

### üêà –ö–æ—Ç—ã (cats)

- –ú–æ–¥–µ–ª—å `Cat` + –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `CatRepo` + `InMemoryCatRepo`
- DTO `CatCreateRequest` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ—Ç–∞
- –ü–æ–ª–Ω—ã–π CRUD:
  - `GET /cats` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ—Ç–æ–≤
  - `GET /cats?breed=...&owner=...` ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ—Ä–æ–¥–µ –∏ –≤–ª–∞–¥–µ–ª—å—Ü—É
  - `GET /cats/:id` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∫–æ—Ç–∞ –ø–æ id
  - `POST /cats` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
  - `DELETE /cats/:id` ‚Äî —É–¥–∞–ª–∏—Ç—å –∫–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—Ç–∞ –∫ –≤–ª–∞–¥–µ–ª—å—Ü—É:
  - –í –∑–∞–ø—Ä–æ—Å–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç `owner_id`
  - –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü —Å —Ç–∞–∫–∏–º `id` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `OwnerRepo`

---

## üß± –°—Ç–µ–∫

- üêπ **Go**
- üå∂Ô∏è **Gin** ‚Äî HTTP‚Äë—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ (–º–∞—Ä—à—Ä—É—Ç—ã, middleware)
- üîê **bcrypt** (`golang.org/x/crypto/bcrypt`) ‚Äî —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- üß† **In‚Äëmemory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (—Å–ª–∞–π—Å—ã/map) –≤–º–µ—Å—Ç–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

.
‚îú‚îÄ‚îÄ main.go                      # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îú‚îÄ‚îÄ user_struct.go           # User, UserCreateRequest, UserLoginRequest, UserResponse
‚îÇ   ‚îú‚îÄ‚îÄ user_repo.go             # –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å UserRepo
‚îÇ   ‚îú‚îÄ‚îÄ user_repo_inmemory.go    # InMemoryUserRepo
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.go          # AuthService: Register/Login, bcrypt, –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ sessions.go              # in‚Äëmemory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
‚îú‚îÄ‚îÄ owners/
‚îÇ   ‚îú‚îÄ‚îÄ owner.go                 # –º–æ–¥–µ–ª—å Owner
‚îÇ   ‚îú‚îÄ‚îÄ owner_repo.go            # –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å OwnerRepo
‚îÇ   ‚îî‚îÄ‚îÄ owner_repo_inmemory.go   # InMemoryOwnerRepo
‚îú‚îÄ‚îÄ cats/
‚îÇ   ‚îú‚îÄ‚îÄ catsstruct.go            # Cat, CatCreateRequest
‚îÇ   ‚îú‚îÄ‚îÄ catrepos.go              # –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å CatRepo (Add, Get, All, Delete, Filter)
‚îÇ   ‚îî‚îÄ‚îÄ repo_inmemory.go         # InMemoryCatRepo (CRUD + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
‚îî‚îÄ‚îÄ handlers/
    ‚îú‚îÄ‚îÄ user_handlers.go         # Register, Login, Me, AuthRequired
    ‚îú‚îÄ‚îÄ cat_handlers.go          # CreateCat, GetAllCat, GetCat, DeleteCat
    ‚îî‚îÄ‚îÄ owner_handlers.go        # CreateOwner, GetAllOwners, GetOwner, DeleteOwner

---

## üîê –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `POST /register`, –ø–∞—Ä–æ–ª—å —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ bcrypt –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `PasswordHash`.
2. –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ (`POST /login`):
   - –ø–æ –ª–æ–≥–∏–Ω—É –∏—â–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ `UserRepo`
   - –ø–∞—Ä–æ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `bcrypt.CompareHashAndPassword`
   - —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π `session_id`
   - –≤ `sessions.go` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å–≤—è–∑—å `session_id -> userID`
   - –≤ –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è cookie `session_id`

3. Middleware `AuthRequired`:
   - —Å—á–∏—Ç—ã–≤–∞–µ—Ç cookie `session_id`
   - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é –≤ in‚Äëmemory map
   - –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –∫–ª–∞–¥—ë—Ç `userID` –≤ `gin.Context` (`c.Set("userID", ...)`)
   - –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 –∏ –Ω–µ –ø—É—Å–∫–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –¥–∞–ª—å—à–µ (`c.Abort()`)

4. –õ—é–±–æ–π –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç middleware, –Ω–∞–ø—Ä–∏–º–µ—Ä:

r.GET("/me", handlers.AuthRequired, userHandlers.Me)
r.POST("/cats", handlers.AuthRequired, catHandlers.CreateCat)
r.DELETE("/cats/:id", handlers.AuthRequired, catHandlers.DeleteCat)

–≠–Ω–¥–ø–æ–∏–Ω—Ç `/me` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `userID` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.

---

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

POST /register
Content-Type: application/json

{
  "login": "kotofan",
  "email": "koto@example.com",
  "password": "123456"
}

–û—Ç–≤–µ—Ç:

{
  "id": 1,
  "login": "kotofan",
  "email": "koto@example.com"
}

### –õ–æ–≥–∏–Ω

POST /login
Content-Type: application/json

{
  "login": "kotofan",
  "password": "123456"
}

–û—Ç–≤–µ—Ç: UserResponse (–±–µ–∑ PasswordHash) + cookie `session_id`.

### –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

GET /me
Cookie: session_id=...

### –°–æ–∑–¥–∞–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞

POST /owners
Content-Type: application/json

{
  "name": "–í–ª–∞–¥–∏–º–∏—Ä",
  "email": "owner@example.com",
  "about": "—Ö–æ–∑—è–∏–Ω –∫–æ—Ç–∏–∫–æ–≤"
}

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ç–∞

POST /cats
Content-Type: application/json
Cookie: session_id=...

{
  "name": "–ë–∞—Ä—Å–∏–∫",
  "breed": "–°–∏–±–∏—Ä—Å–∫–∞—è",
  "age": 3,
  "owner_id": 1,
  "about": "–ª—é–±–∏—Ç —Å–ø–∞—Ç—å –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ"
}

–ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ—Ç–∞ –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü —Å —Ç–∞–∫–∏–º `owner_id` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
–ö–æ—Ç–æ–≤ –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ—Ä–æ–¥–µ –∏ –≤–ª–∞–¥–µ–ª—å—Ü—É:

GET /cats?breed=–°–∏–±–∏—Ä—Å–∫–∞—è&owner=1

---

## –ó–∞–ø—É—Å–∫

go run ./...

–°–µ—Ä–≤–µ—Ä –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ `http://localhost:8080`.

–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

GET /ping
‚Üí {"message": "pong"}

---

## üó∫ –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö


